# 一画室智能图片命名工具 v4.5

基于 PyQt5 的图片批量重命名工具，支持中文 OCR 识别与智能姓名匹配。  
**适用场景**：教育机构作业管理、档案命名等需要从图片中提取中文姓名并批量重命名的场景。

---
程序说明
1. 程序概述
该程序是一个基于 OCR（光学字符识别）技术的图片重命名工具，主要用于从图片中提取文本信息（如姓名），并根据提取的文本对图片进行重命名。程序支持多种 OCR 引擎（如 EasyOCR 和 PaddleOCR），并提供了图像预处理、姓名匹配、重命名等功能。程序还提供了一个图形用户界面（GUI），方便用户操作。

2. 主要功能
OCR 识别：支持 EasyOCR 和 PaddleOCR 两种 OCR 引擎，用户可以选择使用单一引擎或双重识别。

图像预处理：提供多种图像预处理策略，如高对比度处理、自适应阈值处理、颜色反转等，以提高 OCR 识别的准确性。

姓名匹配：根据 OCR 识别结果，程序会从姓名库中匹配最佳姓名，支持形近字匹配、全名匹配、子串匹配等多种匹配策略。

图片重命名：根据匹配的姓名，程序会自动对图片进行重命名，并处理重名情况。

日志记录：程序会记录处理过程中的日志信息，包括成功和失败的操作，方便用户查看和排查问题。

进度显示：程序提供了进度条，实时显示处理进度。

3. 适用场景
教育机构：用于批量处理学生作业图片，根据学生姓名对图片进行重命名。

档案管理：用于对扫描的文档图片进行命名，便于后续管理和检索。

其他场景：任何需要从图片中提取文本并进行批量重命名的场景。

开发日志
1. 初始版本 (main0.3.py)
功能：实现了基本的 OCR 识别功能，使用 EasyOCR 进行文本识别，并根据识别结果对图片进行重命名。

特点：

支持灰底白字的图像预处理。

提供了简单的姓名格式规范化功能。

支持批量处理图片文件夹中的图片。

不足：

仅支持 EasyOCR，识别准确率有限。

姓名匹配逻辑较为简单，无法处理复杂的形近字问题。

2. 优化版本 (main0.7.py)
功能：引入了多种图像预处理策略，并优化了 OCR 识别逻辑。

特点：

增加了自适应阈值、高对比度、颜色反转等图像预处理策略。

提供了智能的 OCR 识别逻辑，根据置信度选择最佳识别结果。

引入了形近字映射表，提高了姓名匹配的准确性。

不足：

仍然只支持 EasyOCR，未引入其他 OCR 引擎。

姓名匹配逻辑虽然有所优化，但仍不够完善。

3. 增强版本 (main0.9.py)
功能：引入了 PaddleOCR，支持双重 OCR 识别，并进一步优化了姓名匹配逻辑。

特点：

支持 EasyOCR 和 PaddleOCR 双重识别，提高了识别准确率。

增加了六级匹配策略，包括形近字匹配、全名匹配、子串匹配等。

提供了更复杂的图像预处理和 OCR 结果选择策略。

不足：

虽然功能增强，但代码复杂度增加，维护难度加大。

未提供图形用户界面，操作不够友好。

4. GUI 版本 (main2.py 和 main3.py)
功能：引入了 Tkinter 图形用户界面，提供了更友好的操作体验。

特点：

提供了文件选择、OCR 设置、日志显示、进度条等 GUI 组件。

支持用户选择 OCR 引擎（EasyOCR、PaddleOCR 或双重识别）。

提供了高级设置选项，如单字兜底匹配、图像预处理等。

不足：

Tkinter 的界面较为简单，美观度不足。

多线程处理逻辑较为复杂，容易出现线程安全问题。

5. PyQt5 版本 (main4.py 和 main4.5.py)
功能：将 GUI 框架从 Tkinter 迁移到 PyQt5，提供了更现代化的界面和更好的用户体验。

特点：

使用 PyQt5 实现了更美观、更易用的图形界面。

支持多线程处理，确保界面不会卡顿。

提供了更完善的日志记录和进度显示功能。

不足：

PyQt5 的学习曲线较陡，开发难度较大。

代码量增加，维护成本提高。

更新日志
v0.3 (main0.3.py)
初始版本发布，支持 EasyOCR 识别和简单的图片重命名功能。

提供了灰底白字的图像预处理功能。

v0.7 (main0.7.py)
增加了多种图像预处理策略，提高了 OCR 识别的准确性。

引入了形近字映射表，优化了姓名匹配逻辑。

v0.9 (main0.9.py)
引入了 PaddleOCR，支持双重 OCR 识别。

增加了六级匹配策略，进一步提高了姓名匹配的准确性。

v2.0 (main2.py)
引入了 Tkinter 图形用户界面，提供了更友好的操作体验。

支持用户选择 OCR 引擎和高级设置选项。

v3.0 (main3.py)
优化了 Tkinter 界面布局，增加了日志显示和进度条功能。

改进了多线程处理逻辑，确保界面不会卡顿。

v4.0 (main4.py)
将 GUI 框架从 Tkinter 迁移到 PyQt5，提供了更现代化的界面。

支持多线程处理，确保界面流畅。

v4.5 (main4.5.py)
进一步优化了 PyQt5 界面布局和交互逻辑。

修复了部分多线程处理中的 bug，提高了程序的稳定性。

未来计划
引入更多 OCR 引擎：如 Tesseract 等，进一步提高识别准确率。

优化姓名匹配算法：引入机器学习模型，提高姓名匹配的准确性。

增加批量处理功能：支持用户一次性处理多个文件夹中的图片。

提供更多图像预处理选项：如去噪、锐化等，进一步提高 OCR 识别的效果。

跨平台支持：确保程序能够在 Windows、macOS 和 Linux 上正常运行。

总结
该程序从最初的简单 OCR 识别工具，逐步发展为功能完善、界面友好的图片重命名工具。通过不断优化 OCR 识别逻辑、姓名匹配算法和用户界面，程序的实用性和用户体验得到了显著提升。未来将继续优化和扩展功能，满足更多用户的需求。

---

## 🛠️ 环境要求

### 硬件要求
- **操作系统**：Windows 11 专业版  
- **显卡**：NVIDIA GeForce RTX 3080（需支持 CUDA 加速）  
- **内存**：≥ 8GB  

### 软件依赖
1. **CUDA 工具包**：11.6（必须安装，用于 GPU 加速）  
   - 下载地址：https://developer.nvidia.com/cuda-11-6-0-download-archive  
2. **cuDNN**：8.4.0（与 CUDA 11.6 兼容）  
   - 下载地址：https://developer.nvidia.com/cudnn  
3. **Python 3.8+**（建议使用 Python 3.8 或 3.9）  

---

## 📦 依赖安装

### 1. 安装 Python 包
打开命令提示符（CMD）执行以下命令：
```bash
# 安装核心依赖
pip install PyQt5 opencv-python easyocr numpy paddlepaddle-gpu==2.4.2.post116 --extra-index-url=https://mirror.baidu.com/pypi/simple
pip install paddleocr shutil collections difflib

### 2. 验证 CUDA 环境
确保 CUDA 11.6 和 cuDNN 已正确安装，并添加以下环境变量：
# 系统环境变量示例
CUDA_PATH = C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.6
PATH += %CUDA_PATH%\bin;%CUDA_PATH%\libnvvp

🚀 使用方法
1. 克隆仓库
bash
复制
git clone https://github.com/your-repo/your-project.git
cd your-project
2. 准备文件
姓名库文件：在项目根目录下创建 name.txt，每行一个姓名（如 张三\n李四\n王五）。

形近字映射表（可选）：创建 similar_map.txt，格式为 原字:替换字（如 彦萜:李彦喆）。

3. 运行程序
bash
复制
python main4.5.py
🖥️ 界面操作指南
1. 文件设置
选择图片文件夹：点击按钮选择包含待处理图片的文件夹（支持 .png, .jpg, .jpeg）。

选择姓名库文件：点击按钮选择 name.txt 文件。

2. OCR 设置
引擎选择：支持 EasyOCR、PaddleOCR 或 双重识别。

高级设置：

✅ 启用图像预处理（默认开启，推荐）

✅ 单字兜底匹配（当其他匹配失败时启用）

✅ 全图识别模式（默认裁剪右下角区域）

3. 开始处理
点击 开始处理 按钮，程序将自动执行以下操作：

识别图片中的文本

匹配姓名库中的最佳结果

重命名图片并生成日志

停止处理：点击 停止 按钮可随时中止任务。

📝 日志与输出
日志文件：处理完成后，图片文件夹内会生成 rename_errors.log，记录失败文件及原因。

重命名规则：

文件名格式：姓名_序号.扩展名（如 张三_1.jpg）

自动跳过已处理的文件（文件名包含 _fuzzy 或匹配到姓名库的图片）。

❓ 常见问题
1. OCR 识别失败
解决方法：

确保图片清晰度足够（建议分辨率 ≥ 800×600）。

尝试启用 全图识别模式 或调整图像预处理参数。

2. GPU 未启用
解决方法：

检查 CUDA 和 cuDNN 是否安装正确。

运行以下代码验证 GPU 支持：

python
复制
import torch
print(torch.cuda.is_available())  # 应输出 True
3. 依赖冲突
解决方法：
使用虚拟环境隔离依赖：

bash
复制
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
📜 许可证
MIT License | © 2023 Lansi1d
